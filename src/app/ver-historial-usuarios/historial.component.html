<div class="historial-container">
  <!-- Encabezado con balance -->
  <div class="header-section">
    <h1 class="main-title">HISTORIAL DE APUESTAS</h1>
    <div class="user-balance">
      <span class="username">{{username.toUpperCase()}}</span>
      <span class="balance">{{formatNumberNoPlus(resumen.saldoActual || 0)}}</span>
    </div>
  </div>

  <!-- Solo visible para superusuarios -->
  <div *ngIf="isSuperUser" class="superuser-ganancias">
    <label for="codigoStream">Código de Stream:</label>
    <input type="text" id="codigoStream" [(ngModel)]="codigoStream" (input)="aplicarFiltros()" placeholder="Ej: Stream1-18-07-2025" />
    <br>
    Stream actual: <b>{{codigoStream || 'Todos'}}</b><br>
    Ganancias totales: 
    <span class="positivo">{{ formatNumber(getGananciasTotales()) }}</span>
    &nbsp;|&nbsp;
    Pérdidas totales: 
    <span class="negativo">{{ formatPerdidas(getPerdidasTotales()) }}</span>
    <br>
    <b>Suma total:</b>
    <span [ngClass]="getGananciasTotales() - getPerdidasTotales() >= 0 ? 'positivo' : 'negativo'">
      {{formatNumber(getGananciasTotales() - getPerdidasTotales())}}
    </span>
  </div>

  <!-- Búsqueda -->
  <div class="search-section">
    <input type="text" class="search-input" [(ngModel)]="searchTerm" (input)="aplicarFiltros()" placeholder="Buscar...">
  </div>

  <!-- Estado de carga -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p class="loading-text">Cargando historial...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error-message">
    <span class="error-icon">!</span>
    {{error}}
  </div>

  <!-- Sin resultados -->
  <div *ngIf="!loading && !error && filteredHistorial.length === 0" class="no-results">
    No se encontraron registros para este usuario.
  </div>

  <!-- Tabla de resultados -->
  <div *ngIf="!loading && !error && filteredHistorial.length > 0" class="table-container">
    <table class="historial-table">
      <thead>
        <tr>
          <th>CONCEPTO</th>
          <th>CANTIDAD</th>
          <th>COLOR</th>
          <th>RESULTADO</th>
          <th>CANTIDAD</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of paginatedItems">
          <td>{{item.concepto}}</td>
          <td>{{ formatNumberNoPlus(item.cantidad) }}</td>
          <td [ngClass]="getColorClass(item.color)">{{item.color}}</td>
          <td>{{item.queda || item.resultado}}</td>
          <td>
            <span [ngClass]="item.cantidadFinal >= 0 ? 'positivo' : 'negativo'">
              {{ formatNumber(item.cantidadFinal) }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div *ngIf="filteredHistorial.length > itemsPerPage" class="pagination-controls">
    <button class="pagination-btn" 
            (click)="pageChanged(currentPage - 1)"
            [disabled]="currentPage === 1">
      ‹ Anterior
    </button>
    
    <span class="page-info">{{currentPage}} / {{totalPages}}</span>
    
    <button class="pagination-btn" 
            (click)="pageChanged(currentPage + 1)"
            [disabled]="currentPage === totalPages">
      Siguiente ›
    </button>
    
    <button class="close-btn" 
            (click)="goBack()">
      ✕ Cerrar
    </button>
  </div>
</div>
